'''Ana'''
import numpy as np
import matplotlib.pyplot as plt


# Sampling parameters
sampling_freq = 100  # Sampling frequency in Hz
num_samples = 1000    # Number of samples to acquire

# analysis variables
window_size = 20 # for calculating intensities- it's the sample number
tremor_window = (3, 17)  # bounds of data we are using for analysis in Hz
intensity_threshold = 0.001


# functions
def generate_sine_wave(frequency1, amplitude1, duration1, sampling_rate1):
    t = np.linspace(0, duration1, int(duration1 * sampling_rate1), endpoint=False)
    signal = amplitude1 * np.sin(2 * np.pi * frequency1 * t)
    return signal


def tremor_window_fft(fft_result, fft_freq, tremor_window1):  # t window is lower than the upper bound in hz
    new_fft_result = []
    new_fft_freq = []
    for i in range(len(fft_freq)):
        if (abs(fft_freq[i]) >= tremor_window1[0]) and (abs(fft_freq[i]) <= tremor_window1[1]):
            new_fft_result.append(fft_result[i])
            new_fft_freq.append(fft_freq[i])
    return new_fft_result, new_fft_freq
# Function to perform FFT and find the dominant frequency


def analyze_frequency(signal):

    # Perform FFT on the signal
    fft_result = np.fft.fft(signal)
    fft_freq = np.fft.fftfreq(len(signal), (1 / sampling_freq))
    tremor_n = len(dominant_frequency_array) +1
    fft_freq_positive = fft_freq[:len(signal) // 2]

    plt.plot(fft_freq_positive, np.abs(fft_result[:len(signal) // 2]))
    plt.title('Frequency Composition of Tremor ' + str(tremor_n))
    plt.xlabel('Frequency Hz')
    plt.ylabel('Intensity')
    plt.show()
    fft_result, fft_freq = tremor_window_fft(fft_result, fft_freq, tremor_window)

    # Find the index of the maximum magnitude in the FFT result
    if len(fft_result) > 0:
        max_index = np.argmax(np.abs(fft_result))
        # Extract the dominant frequency
        dominant_freq = abs(fft_freq[max_index])
    else:
        dominant_freq = 0
    return dominant_freq


def calculate_intensity(signal):
    ''' the input of this function is a small sample of the signal in the window size.
     The values have to be positive so i will square the input signal'''
    # Calculate the area under the curve using the trapezoidal rule
    signal_array = np.array(signal)
    signal_squared = signal_array*signal_array
    area = np.trapz(signal_squared)
    intensity1 = area / window_size
    return intensity1


def calculate_tremor_length_intensity(tremor_intensities1):
    length = len(tremor_intensities1)*window_size/sampling_freq # length of time of tremor
    total_intensity = 0
    for j in tremor_intensities:
        total_intensity += j
    if length != 0:
        average_intensity = total_intensity/len(tremor_intensities1)

    else:
        average_intensity = 0
    return length, average_intensity


def calculate_values_and_append(tremor_intensities1, tremor_data1):
    length, average_intensity = calculate_tremor_length_intensity(tremor_intensities1)
    dominant_frequency = analyze_frequency(tremor_data1)


    dominant_frequency_array.append(dominant_frequency)
    length_array.append(length)
    average_intensity_array.append(average_intensity)

def readjoystickTextFile(fileName):
    data = []
    xPos_vector = []
    yPos_vector = []
    iteration = []
    j = 0
    with open('./JoystickTextFiles/{}'.format(fileName), 'r') as file:
        for line in file:
            j += 1
            nums = ((line.strip().split(','))) # Convert each line to a float and append to the data list
            values = []
            for i in range(3):
                values.append(float(nums[i]))
            xPos_vector.append(values[1])
            yPos_vector.append(values[2])
            iteration.append(j)
    return xPos_vector, yPos_vector

# Main loop for signal acquisition and analysis

'''listXPOS, listYPOS = readjoystickTextFile(fileName = 'tremor_simulator_100HZ.txt')
position= []
for i in range(len(listXPOS)-1):
    position.append( listXPOS[i] + listYPOS[i]*1j)
plt.plot(listXPOS)
plt.plot(listYPOS)
plt.plot(position)
plt.show()'''

# arrays for analysis
signal_buffer = []
dominant_frequency_array = []
length_array = []
average_intensity_array = []
tremor_data = []
tremor_intensities = []
intensity_of_whole_signal = []
# initial conditions
tremor_present = False  # initial cond for the loops to work
i = 0
tremor_count = 0
input_data = [-0.0016164744785263933, -0.0017709380432793308, -0.001174020688160222, -0.001361997906254607, -0.001283413163389395, -0.0016319477608917814, -0.0012727014488439924, -0.0006859090124254575, -0.00028787333372658165, -0.000515170653104823, -1.3551857454554075e-05, -0.0006530248148642085, 9.829107159599554e-05, 0.0003481009492193308, 0.000490796837103171, -8.64723816826128e-05, 0.0002905567815721967, -0.0004114410086708221, -4.624881410951985e-06, 0.0003404916668534115, -0.00029134826772675383, -1.5912226536468708e-05, 0.00038804121079343305, 0.0005500722540914557, 0.000615288952553601, 0.0005809326623888566, 2.4496104879102518e-05, 0.0005968867699180612, -8.053730008855502e-05, 0.0011045905026073732, -2.13235795678288e-05, -8.926697093546978e-05, 0.0009169218143051431, 0.0015340912682939832, 0.0005410811362183412, 0.0015458318254467918, 0.0003080256508370444, -6.82988803449398e-05, -0.0003520579467162651, -0.0003194937498354647, -0.0017543589215052251, -0.000797172359328021, -0.0006737203294434344, -0.00012269760549497855, 3.424082534085604e-05, -0.00023711003293030693, 0.0007727999923243327, 0.0003003697812923524, 0.00043534046234856155, 0.00019458409147163824, -0.0005338491631567827, 5.5844999371895774e-05, 0.0007995225871896194, -5.565286824282421e-05, -3.1045920228998415e-05, 0.0001836877323955952, 8.006925814101453e-05, 0.00030335457884510947, 0.00012006583197978968, 0.0003259736047093631, -0.00023666329660031573, 0.00015818600628879657, 8.000268681550814e-05, 0.00032185328143893247, -0.00018775928391810432, 0.00025065890509819036, -0.00018892680084165716, 1.534492432976424e-05, 0.0003215429390169577, 0.00047448758606316935, 0.0004503923016997719, 0.00018809269912690822, -0.00019304668057021487, 0.0002660321448323907, 9.927124124267314e-05, 0.0008912640491267241, 0.0005127433671323696, 0.000367191971272668, 0.000546324972354544, 0.0003379415966849311, 0.0007823816342291605, -0.00048252162706574923, -0.000386619263960929, -8.931175161843883e-05, 0.000836181004240555, 5.2568234629279346e-05, 0.00010387751589712802, 6.485237319917491e-05, -0.0004100296301957551, -0.0005645460505139905, 5.755167921845522e-05, -0.0003493478694121437, -0.00018277562246802638, 0.00015358976068685637, 0.0003992333553350519, 0.00045720954552917574, 0.00048705720269059645, 0.0004937761594481374, 0.000979181794277047, -4.686586370790955e-05, -8.935037075840811e-05, -0.00017218714920954345, 9.105411660554653e-05, -0.00037189585439131347, 0.0008889500894278374, 0.0004315543632102889, -0.00022194266222209632, 0.00034241060187800883, -0.00019161834696773726, 0.00014182318621034414, -0.0005848463668774147, -0.0005089518947540366, 8.648350380586903e-05, -0.0002562756209044206, 2.2645392006597712e-05, 0.00017150184827318532, 0.00046660158403836116, 7.038572413748225e-05, -6.705027275018607e-05, 0.00045934962978827314, 4.512753765482415e-05, 0.0004224278427791021, 0.0005557361810704276, 0.0005637209284607824, 0.0005203558655504995, 0.00048443500469677126, -8.030347542375971e-05, 0.00025593846727587537, -0.00024295001145529507, -0.0003438312571708629, -0.0004124489351273533, -0.0003564181083228744, -1.919333587954101e-05, 0.00042506595645826987, 0.0005904102946764386, 0.001475859271363478, 0.000571797227647477, 1.4181551970180763e-05, 0.00030227161252712733, 0.00036506833545602935, 0.0003190226940099753, -2.4568313149486362e-05, 0.0001062333806547285, 0.0006910822285670368, 0.0003173993637660432, 0.00027644091847108193, 0.00022106156245418548, -0.0006649728235824034, -0.00037752183820065127, 1.7931562399786573e-05, 0.0001872094755987863, 0.000215926708797041, 0.00023291433275351037, -0.0002428026458397279, 0.0009960268388386762, 4.880830656841129e-06, 0.0002781883545929522, 0.0007662939842654254, 0.0014471034237906832, 0.0002013920581407985, -0.0004670142220391349, -0.0001846734948027784, -0.0005804455396887492, 0.0003275929961924647, -0.0009142562900289314, 5.667552409074428e-05, -0.00020599112121321046, -0.00013952529440862307, 0.000785979755134661, 0.0005664483470850354, 0.00012447603068961935, 0.0002700884633242929, 0.0005129525574021285, 0.0011885274264249726, 0.0001502706307787839, -0.00044388147134572474, -0.0006663197717323476, -0.0007118129390665646, -7.97149921670029e-05, -0.00036367235781030113, 0.0006433299017833726, -0.00039780600753178174, 0.00017698121449662022, 0.00016350824673350573, -0.0003134111169444268, 0.000561549532345594, 0.0010986274443162659, 0.000634697636657649, -0.0006060807828796285, 4.4407943203317746e-05, -0.00047547221042831605, -0.0006314057554895401, -0.0001082750131784875, 0.00012932345443338565, 0.00041021932784968606, 2.2576170348044978e-05, -0.00027122585267354065, -2.175593665372901e-05, 0.0005491265167421951, 0.0004962148455575463, 0.00016268670536643713, 0.0002566314570105928, 0.0005640599864504036, 0.000649787271364651, 0.0006885035854540585, -0.00016805614471188937, 4.744177254276897e-05, 0.0003417053640099475, 0.00020696795808033183, -0.0003923723587334754, 0.0013030633934197867, 0.0006895191653099797, -2.2886225781965346e-05, -0.0002932306770723268, -0.0008385847424052838, 3.415411258544899e-05, 0.0003402605453563627, 0.00020282041115373068, 0.00014751048647067017, -0.0004738471188663329, 0.0003073788660141316, 0.0006048714082267435, 0.0006765657437145765, 9.131212980350049e-05, 8.792567584368222e-05, 0.000356425168442572, 0.0004837732996486946, 0.00021900029131214195, 0.00040088412110634566, 0.0003603519070776249, 0.0003568707561982451, -0.0012713215379922932, -7.470635376343208e-05, -0.00026834343809602765, 0.000294319210112152, -9.010862196962748e-05, 0.00042859838847942146, 0.00026584608160410165, 0.0002950034883149144, 0.0005554456862793995, 0.000427640595275826, 0.0004706869495617388, 0.000490349199300793, 0.004207725104509922, 0.012985529220871492, 0.0034107055817119343, -0.00035291115849872, -0.0018694817813267603, -0.0022880022568374523, -0.0026426288920359817, 0.2153425324924229, 0.280183233985145, 0.05815800607405257, -0.02861958478236907, -0.06358083043550825, -0.07663535974028847, -0.08269256040451901, -0.0856366260236485, -0.08629083314271165, -0.08626504383157886, -0.06319276787458043, -0.025524879408392334, -0.010095752168940805, -0.003596029394886337, -0.0009662827960720821, -0.0001803899040955458, -7.013560281838747e-05, -0.000887984584339553, 0.0005629326870086773, 0.000502848247647382, 0.0006723479721983412, 0.0008966011210770771, 0.0014976188256378108, 0.0010641377436606102, 0.00036742517015929226, 0.000601279288871649, 7.216576735548895e-05, 0.0013576953213930423, 0.0006215497960062643, 0.00033082286218528555, 0.0001264704101258617, 0.000898473879923219, 0.00031042754847577635, -0.0006648423022009792, -0.0002530830452619425, -7.844964639084143e-05, -0.00034665122549680646, -0.0002928091571016574, 0.0005691086905685789, 0.00029425165907140394, 0.00021201522836402763, -2.2385773098015493e-05, 0.0010237437893544513, 0.00013044209132432238, 0.00013289118435279518, -0.0007298531125021117, -0.00013985474590683588, -7.10815825707414e-06, 0.00016546449817246523, 0.00019015380280612256, 0.00050640417188584, 0.0002655931227644845, -0.0005137530924525856, -0.00022800838491927183, 0.00017640673714994486, -0.00028848246985322106, 0.00013045351137365045, 0.0013608806450807654, 0.0006397664289834529, 0.0003849109227122547, 0.00028503883276244195, 0.0002702106404047465, -0.00011709394230571346, -0.0005234753458985236, 0.00044351825101694156, 0.00015331222251457497, -0.00048060822493381245, -0.0008255273148846413, -4.327016614398809e-05, -0.0005716465125979045, 0.00016473894977252776, 0.0012119032267768645, 0.0007278304827470715, -7.271469766805894e-05, -0.0005254726898124419, -7.598679567592109e-05, 0.0008722035377681037, 0.0005467019656505987, 0.00043361792457699555, 0.00028335738781354834, 0.00022885639961375348, 0.0002933948710726348, 0.00032915897038951003, 0.0002746179119798909, 0.00016459919611345195, -0.00045693927733012974, 0.0007812762141920664, 0.00033506308377098106, 0.00020793190974369375, -0.00042455623722515963, -2.923856306507591e-05, 7.764688640656296e-05, -0.0003757212816231986, 0.0008290441592205223, 0.00039872665905122794, 0.0001931507375452276, -9.434196641593551e-05, 0.00012531859477179705, -0.000359990837857795, 2.6872636579756623e-05, 0.00013205845788891732, 0.0007544040670053695, 0.00029559084659124164, 0.0002492491630462137, -7.111938397602689e-05, -0.00013544625577002496, 8.186300207563106e-05, -8.602875032694959e-05, 0.0008891022263391307, 0.00035452322259837705, 0.00017800143053761522, 0.0001367978684633309, 0.0012276613182631423, -0.00012569063084150135, -2.007777645367248e-05, -8.6053969911736e-05, -5.015931908262158e-05, -0.0001178435422341884, -1.3248245272211388e-05, 8.990280321551081e-07, 0.0008377070292683105, 0.0002338319174195764, 0.0001621420247451947, -0.0004986336432292672, -0.0003966932458040152, -0.0006290907331280298, -0.000355313746295952, 2.0007294556954186e-05, -0.0006147571505376601, -0.0005066596593573244, -4.573219936710067e-05, 0.00017476777154953362, 0.00029089197629087555, 0.0005807240739582609, 0.0006541390620043992, 0.00036220654230007063, -2.8035826072901962e-05, -0.0001135843998234902, 0.00035583550727382373, -0.0003373675709208413, 0.0005507547380566437, -9.603864814491242e-06, 0.0001224546663361305, 0.00015338461815975158, 0.0010496748367285025, 0.0007225408335188579, 4.771905544480922e-05, 0.0002802387949866355, -0.00015013615927436967, -0.0006208532692880261, -0.00041550514685694115, -0.0014132776913961453, -1.5459628342370975e-05, 0.00045645521354235104, 0.0007526617383746153, 0.0008376563218835458, 0.0008395839512339819, 0.000813189619098942, 0.0007648818121386075, -0.001254055936527376, -0.0007718581595064365, 0.001953240708409404, 0.05211779450418077, 0.013994340880455758, 0.0007829210543146264, -0.006223306274015101, -0.008162769883489941, -0.009772293219702244, -0.007550870611058738, -0.007896125183691746, 0.09933418546204519, 0.12532896733263757, 0.024101677766222754, -0.015143994898940402, -0.03177881085893459, -0.03765831868718574, -0.04079590475044435, -0.04278787794538815, -0.04245604441524758, -0.04163360582092924, -0.02926203877044349, -0.0113153274013958, -0.00418682555235674, -0.00027005202378563905, 5.068569757182232e-05, 0.014221731758308487, 0.018440323610364594, 0.05574107257327393, 0.06816703530835627, 0.012435429995964115, -0.010007521715687447, -0.02039382706556065, -0.023350781966539554, -0.025688077032404485, -0.026310286822844288, -0.02498873871967316, -0.023076099421314708, -0.016337538483650656, -0.007072385461756646, -0.00343991722808395, -0.0015591086799628204, 0.011613243976393677, 0.014492385826612681, 0.020513394120667102, 0.022738748479614768, 0.14264378127972774, 0.11621147446214612, 0.08889125319379862, 0.06779830213190058, 0.1327530750436158, 0.14743655618635043, 0.12603051444223926, 0.10526946647426605, 0.02003327371437119, 0.04919718694607464, 0.008406613923802958, -0.010264323901082423, -0.09262749560068803, -0.11968264511125909, -0.12243837413755942, -0.10849267756456221, -0.09221873375752071, -0.07213420110294029, -0.08085063745020124, -0.10736942681487908, -0.09679896454241319, -0.07933946383176865, -0.041306636632822955, -0.043199262100258116, -0.032659525182660416, -0.02652048707958972, -0.029346188925890474, -0.02460818298727957, -0.017820457517394677, -0.01564500872419588, -0.013532590831759377, -0.012732848000387395, -0.010945692972632638, 0.00672519282310788, 0.012539132875737671, 0.03827397227378631, 0.008580632496676245, 0.12622654906279182, 0.14158422918461008, 0.07531767018045907, -0.014357588345728665, -0.0473333025686585, -0.06178078605778561, -0.06541971835383772, -0.0666738531752294, -0.06184978027655208, 0.015290529103911113, 0.05095209930100461, 0.07587197617665772, 0.0687609896623259, 0.11765513471402682, 0.11597425323264694, 0.09811813789432079, 0.07646957233712642, 0.055371569226301875, 0.03317076466614288, 0.01985828055087227, 0.00881188819055262, -0.11577210744839947, -0.15309648942014442, -0.15004925693735666, -0.042871163979409335, 0.02415917133575382, 0.08095748592176061, 0.09420527343117188, 0.08998853433705367, 0.10738000631699016, 0.06673498675033798, 0.03754305381874312, -0.1014776688096289, -0.0655100563934474, -0.056844613335715555, -0.04852390606157378, -0.13735776390492266, -0.10006382122382618, -0.07499390024115536, -0.01314716901248622, 0.015542219265186646, -0.06384238883241358, 0.019628976650267527, 0.01575883636233205, 0.01956271029124515, -0.0041120924141926085, 0.0432541033088438, 0.04773501959281684, 0.04515999763226958, -0.033869160311528757, -0.05395369094478236, -0.048478210112339964, 0.010894638215265845, 0.029992604780390397, -0.06761517747157512, 0.031454255473572335, 0.038803045221231125, 0.049778360603156074, -0.028339475561215383, -0.011397295784626754, -0.015819944557645044, -0.024469411312070338, -0.026836805037559947, -0.020999270771834444, -0.04202337283324409, -0.09678404887325179, -0.009682007679377908, 0.03738260114648906, 0.07821788464522286, 0.08065261876146845, 0.14802549283803962, 0.1876325683801984, 0.13066053805776226, 0.07259213326574149, 0.02777940775497112, 0.012114550104559474, -0.007189412747480695, -0.019470271611758683, -0.20145691866497376, -0.16979835622396577, -0.148558412988305, -0.06570782157900745, -0.04717164702656024, -0.08189959987639456, -0.08641243615830532, -0.14125896493710777, -0.1429654460152068, -0.1226217011240533, -0.11391354946086502, -0.10378772872369622, -0.08689421243811533, -0.06707395541207066, -0.04357403138459418, -0.026167941070625464, -0.011289079044163378, -0.00600397866569009, -0.002205033561745632, -0.0008447121198313702, -3.8930939601982545e-05, -0.00013043713561262547, 0.00029922177027135463, -0.00019317249404281114, -5.4019186691213906e-05, 0.00029589056376362133, -0.00010642559550158408, 0.00020067965471899565, 0.00034383016507952063, -0.0003962502347139413, -0.00032012566090493244, 0.0002676218547779585, 0.0005005759952233335, 0.0005357573288696702, 0.0005138484610110916, 0.0005081325693380347, -9.587445686871487e-05, 0.0002735648861899717, 0.0004012219624185136, 0.00010901220215225101, 0.00021806227581071562, 0.0002633792145796095, 0.00028039229453749245, 0.001096565784396045, 0.000233229886460106, -0.00031078026000785474, -0.0002846287599622076, 3.8744063968497444e-05, -0.00011731402066133363, 0.00011007727082988162, 0.0001770195782255634, 0.00022402553874003358, -4.3106687260321356e-05, 0.00026137171827859485, 0.0008754672832804249, -0.0003491751608093339, 5.8607388821936904e-05, 0.000987898369833783, 0.0007142972912043619, 0.0003002666745299215, 0.00014363769764756283, 7.3101523317447e-05, 2.0801194744360808e-05, -0.000276939943647666, -0.000561704833189851, -0.00016544336241705983, -2.4945113025590365e-05, -0.00013187004722109907, -0.0001134976592756954, -7.251363482040259e-05, -0.0005655603996845946, 0.0001526801004737865, 0.0004110038425217681, 0.0005088627102188626, 0.00046535163245699576, 0.00019309875623900463, -0.0006987224347498175, -0.0003994633838521706, -0.0002805657510866512, 9.434173139798163e-05, 0.0004253216739236276, 0.0005703084637926404, 0.0006187430975080396, 0.001185463649594482, -0.0008240350525834388, 0.0004781472227628576, 0.00021095167833789586, -0.00010986550042510609, 0.0010424965354776045, 0.0008636805453102138, 0.00048336965547734773, 0.00034401077778837804, 0.00027744446717035964, -0.0002185638842976392, 1.0853682626254472e-05, -0.00043731433818377206, -0.0002749069281516238, -1.1264237028746436e-05, 0.0002097114991044262, -0.000224138533655497, -0.0005790723058927832, 0.00016548284184344716, 0.0004583666564096224, 0.00025046232135288345, 0.00046626018759131707, 0.0002182662641014659, -0.00041303281234204067, 0.0010496663185521047, 0.00015429623598791362, 0.0012087159260798911, 0.0005510015410925984, 0.0003721018441912522, -3.889550385758299e-05, 0.0001306989964068965, 0.0004069476592643826, -0.0003076232953703375, -0.00010429665720597262, 6.71275144312226e-05, 8.210418252343294e-05, 0.00016933168407161142, 0.00021849128427477984, 0.00022643141015839079, -0.0005991692504778209, -0.0002893213508890157, -0.00039182837844222536, -0.00040733309724500216, -0.00010514223482169195, 0.0011385341084248998, -0.00010856823673966202, -0.0004485470845671754, -0.00027596973491616225, 0.0001641739015469483, -2.676463825660629e-05, 0.0010385910865941587, 0.00021240419271296301, 0.0015637391180187735, 0.0007792783954412587, 0.0011943469522842356, 0.0011188898328113469, 0.00019402913187939637, -0.0015964588069796704, -0.0004781605175005581, -0.000450229500773888, -1.1409481233790215e-06, -0.0007552861620587518, 0.0008424241687374234, 0.0013041906785808128, 0.0007182526634504495, -3.0484399004392787e-05, 0.00028630292428126264, 0.0012566907979070252, 0.00044975164027048244, 0.00011481468262814799, -3.690279465779845e-05, -0.0009825768730615304, -0.0003685009823003282, -0.0008520711177397583, 0.0006986874205956802, 0.0002926552234080895, -0.0014185369686732282, -0.00019864988883995516, 0.0002781599807162626, 0.00020975628889523647, 0.00021176339589114345, 0.00042411530414710385, 0.0004958625826431457, 0.00044506309310188416, -0.0003077781084063237, -0.00020917989000622398, 0.0002130233846989152, -0.00015031183972037763, 4.330858899794605e-05, 0.0003794953228330902, 0.00048585493411661563, 0.0005252152483842011, 0.0005440546903967532, 0.0008187526038863535, 0.0005332288421962686, 0.000361649852674882, 0.0002861488943622613, -6.849132473226533e-05, -0.0007511438695741012, -0.00011038217464395686, -0.0006902579664625407, 2.115860403558399e-05, -0.00028520376561175535, 0.0002796171833264428, 0.00044982977926348025, 0.0002954076262814444, 0.0005018457433247723, 0.0005752600279129746, 0.0004945302395632815, -0.00033595763486843344, -0.00011706580598082024, 0.00024492379155192966, 7.58995118686481e-05, 2.8494648589113408e-05, -0.00021930237493226687, 0.00025095410724480403, 0.0004266818367935597, 0.0005079069194096554, 0.0016094723876964928, 0.0007404485659787945, 0.00039429348440598363, -0.00031191239758688975, 1.1882957812516751e-05, -0.0015491037840143535, -0.0008994467269948479, -0.00012463334550493138, 0.0002457710525698982, 7.557334264774417e-05, 0.0012848711932061832, 0.00027365970493668746, 0.0005459170560981126, 0.0005194000135556368, 0.0005669114456354793, 0.0003560419888849146, -0.0005695500123028851, -0.0008553503215339301, -6.0613641142709396e-05, 0.0002033667624071222, 0.0004183390104877194, -0.0003730663444790668, 0.00023339829145368508, 0.00044058038878395803, 0.0005535083085506671, 3.547911874268554e-05, -0.00016790574264956238]

t = np.arange(0, len(input_data)) / sampling_freq


while i <= (len(input_data)-1):
    signal_buffer.extend([input_data[i]])
    if len(signal_buffer) >= window_size:
        intensity = calculate_intensity(signal_buffer)
        intensity_of_whole_signal.extend([intensity])
        if intensity >= intensity_threshold and tremor_present == False:
            print('tremor started at:', i / sampling_freq)

        if intensity >= intensity_threshold:
            tremor_present = True
            tremor_data.extend(signal_buffer)
            tremor_intensities.extend([intensity])
        if tremor_present:
            if intensity <= intensity_threshold:
                tremor_present = False
                print('tremor ended at:', i/sampling_freq)
                calculate_values_and_append(tremor_intensities, tremor_data)
                tremor_data = []
                tremor_intensities = []

        signal_buffer = []

    i = i+1
if tremor_present:
    tremor_present = False
    calculate_values_and_append(tremor_intensities, tremor_data)
    tremor_data = []


fig, axs = plt.subplots(2)
fig.suptitle('The Filtered Input Signal and Its Intensity')
axs[0].plot(t, input_data)
axs[0].set(ylabel='Amplitude', xlabel='Time (s)')
axs[1].plot(intensity_of_whole_signal, marker='o', markerfacecolor='red', markersize=6)
axs[1].set(ylabel='Intensity', xlabel='Number of Samples')

# Print the analysis outputs
print("Dominant Frequency:", dominant_frequency_array)
print("Length:", length_array)
print("Average Intensity:", average_intensity_array)

plt.tight_layout()
plt.show()